# Tests only the solver; not the transformer

from dpll.solver import Solver, SolverClause, SolverVariable


def dimacs_cnf_to_clauses(file: str) -> list[SolverClause]:
    """Small helper methods to parse test cases from online source"""
    clauses = []

    for line in file.split("\n"):
        vars = line.strip().split()
        new_clause = SolverClause()

        if line[0] == "%":
            break
        if line[0] == "p" or line[0] == "c":
            continue

        for var in vars[0:3]:  # all clauses have 3 literals so safe
            if var[0] == "-":
                new_clause.add(SolverVariable(var[1:].strip(), False))
            else:
                new_clause.add(SolverVariable(var[0:].strip(), True))

        clauses.append(new_clause)

    return clauses


def test_sat_case():
    clauses = dimacs_cnf_to_clauses(sat_case)

    assert (Solver.dpll(clauses).satisfiable is True)


def test_unsat_cases():
    clauses = dimacs_cnf_to_clauses(unsat_case)

    assert (Solver.dpll(clauses).satisfiable is False)


# Test case uuf50-218/uuf50-01.cnf from https://www.cs.ubc.ca/%7Ehoos/SATLIB/benchm.html
unsat_case = """c This Formular is generated by mcnf
c
c    horn? no 
c    forced? no 
c    mixed sat? no 
c    clause length = 3 
c
p cnf 50  218 
 18 -8 29 0
-16 3 18 0
-36 -11 -30 0
-50 20 32 0
-6 9 35 0
42 -38 29 0
43 -15 10 0
-48 -47 1 0
-45 -16 33 0
38 42 22 0
-49 41 -34 0
12 17 35 0
22 -49 7 0
-10 -11 -39 0
-28 -36 -37 0
-13 -46 -41 0
21 -4 9 0
12 48 10 0
24 23 15 0
-8 -41 -43 0
-44 -2 -35 0
-27 18 31 0
47 35 6 0
-11 -27 41 0
-33 -47 -45 0
-16 36 -37 0
27 -46 2 0
15 -28 10 0
-38 46 -39 0
-33 -4 24 0
-12 -45 50 0
-32 -21 -15 0
8 42 24 0
30 -49 4 0
45 -9 28 0
-33 -47 -1 0
1 27 -16 0
-11 -17 -35 0
-42 -15 45 0
-19 -27 30 0
3 28 12 0
48 -11 -33 0
-6 37 -9 0
-37 13 -7 0
-2 26 16 0
46 -24 -38 0
-13 -24 -8 0
-36 -42 -21 0
-37 -19 3 0
-31 -50 35 0
-7 -26 29 0
-42 -45 29 0
33 25 -6 0
-45 -5 7 0
-7 28 -6 0
-48 31 -11 0
32 16 -37 0
-24 48 1 0
18 -46 23 0
-30 -50 48 0
-21 39 -2 0
24 47 42 0
-36 30 4 0
-5 28 -1 0
-47 32 -42 0
16 37 -22 0
-43 42 -34 0
-40 39 -20 0
-49 29 6 0
-41 -3 39 0
-16 -12 43 0
24 22 3 0
47 -45 43 0
45 -37 46 0
-9 26 5 0
-3 23 -13 0
5 -34 13 0
12 39 13 0
22 50 37 0
19 9 46 0
-24 8 -27 0
-28 7 21 0
8 -25 50 0
20 50 4 0
27 36 13 0
26 31 -25 0
39 -44 -32 0
-20 41 -10 0
49 -28 35 0
1 44 34 0
39 35 -11 0
-50 -42 -7 0
-24 7 47 0
-13 5 -48 0
-9 -20 -23 0
2 17 -19 0
11 23 21 0
-45 30 15 0
11 26 -24 0
38 33 -13 0
44 -27 -7 0
41 49 2 0
-18 12 -37 0
-2 12 -26 0
-19 7 32 0
-22 11 33 0
8 12 -20 0
16 40 -48 0
-2 -24 -11 0
26 -17 37 0
-14 -19 46 0
5 47 36 0
-29 -9 19 0
32 4 28 0
-34 20 -46 0
-4 -36 -13 0
-15 -37 45 0
-21 29 23 0
-6 -40 7 0
-42 31 -29 0
-36 24 31 0
-45 -37 -1 0
3 -6 -29 0
-28 -50 27 0
44 26 5 0
-17 -48 49 0
12 -40 -7 0
-12 31 -48 0
27 32 -42 0
-27 -10 1 0
6 -49 10 0
-24 8 43 0
23 31 1 0
11 -47 38 0
-28 26 -13 0
-40 12 -42 0
-3 39 46 0
17 41 46 0
23 21 13 0
-14 -1 -38 0
20 18 6 0
-50 20 -9 0
10 -32 -18 0
-21 49 -34 0
44 23 -35 0
40 -19 34 0
-1 6 -12 0
6 -2 -7 0
32 -20 34 0
-12 43 -29 0
24 2 -49 0
10 -4 40 0
11 5 12 0
-3 47 -31 0
43 -23 21 0
-41 -36 -50 0
-8 -42 -24 0
39 45 7 0
7 37 -45 0
41 40 8 0
-50 -10 -8 0
-5 -39 -14 0
-22 -24 -43 0
-36 40 35 0
17 49 41 0
-32 7 24 0
-30 -8 -9 0
-41 -13 -10 0
31 26 -33 0
17 -22 -39 0
-21 28 3 0
-14 46 23 0
29 16 19 0
42 -32 -44 0
-24 10 23 0
-1 -32 -21 0
-8 -44 -39 0
39 11 9 0
19 14 -46 0
46 44 -42 0
37 23 -29 0
32 25 20 0
14 -43 -12 0
-36 -18 46 0
14 -26 -10 0
-2 -30 5 0
6 -18 46 0
-26 2 -44 0
20 -8 -11 0
-31 3 16 0
-22 -9 39 0
-49 44 -42 0
-45 -44 31 0
-31 50 -11 0
-32 -46 2 0
-6 -7 17 0
19 -32 48 0
39 20 -10 0
-22 -37 38 0
-31 9 -48 0
40 12 7 0
-24 -4 9 0
-22 49 33 0
-12 43 10 0
25 -30 -10 0
46 47 31 0
13 27 -7 0
-45 32 -35 0
-50 34 9 0
2 34 30 0
3 16 2 0
-18 45 -12 0
33 37 10 0
43 7 -18 0
-22 44 -19 0
-31 -27 -42 0
-3 -40 8 0
-23 -31 38 0
%
0""" # noqa

# Test case uf50-218/uf50-01.cnf from https://www.cs.ubc.ca/%7Ehoos/SATLIB/benchm.html
sat_case = """c This Formular is generated by mcnf
c
c    horn? no 
c    forced? no 
c    mixed sat? no 
c    clause length = 3 
c
p cnf 50  218 
 -3 36 7 0
-3 -42 -48 0
-49 -47 -41 0
8 -40 17 0
-21 -31 -39 0
36 -22 49 0
27 38 14 0
15 -18 6 0
6 7 -43 0
34 -7 23 0
2 14 -13 0
2 47 -42 0
-33 -35 3 0
44 40 49 0
50 36 31 0
-36 -3 -37 0
26 -29 43 0
15 29 -45 0
24 -11 18 0
-47 -26 6 0
-50 -33 -10 0
32 6 16 0
-34 37 41 0
7 -28 -17 0
-44 46 19 0
7 22 -48 0
3 39 34 0
31 46 -43 0
-27 32 23 0
37 -50 -18 0
20 5 11 0
-45 -24 6 0
-34 -23 -14 0
-22 21 20 0
-17 50 24 0
-25 -24 -27 0
3 35 21 0
-26 47 -36 0
-28 -45 49 0
-21 -6 12 0
-17 -15 -39 0
41 2 -14 0
25 36 -23 0
-39 -3 -40 0
50 20 35 0
27 31 -39 0
45 -15 -40 0
34 50 35 0
-1 -48 12 0
18 -35 -30 0
27 -24 -25 0
-4 -33 -12 0
-43 -24 -37 0
-37 31 -44 0
-9 -38 14 0
33 -16 34 0
4 -35 -5 0
-3 -21 -19 0
-35 -36 -29 0
7 -43 36 0
30 14 41 0
-35 -24 -7 0
35 -42 6 0
-1 -15 39 0
27 49 -16 0
-37 49 -10 0
50 -46 -3 0
-41 20 34 0
-1 23 28 0
-12 -30 -20 0
-24 29 -37 0
12 5 -44 0
-6 -2 48 0
-2 -49 -43 0
1 -50 24 0
-7 -50 -44 0
-41 43 4 0
13 15 -11 0
-3 -11 23 0
33 48 41 0
9 23 -49 0
-43 47 1 0
-40 16 -29 0
30 19 3 0
19 -34 48 0
-16 -44 14 0
38 -45 -12 0
-4 -14 -31 0
-48 35 -1 0
45 -13 19 0
9 42 -7 0
-1 -15 8 0
-13 -44 -14 0
-43 -37 -31 0
-27 -29 47 0
7 4 17 0
7 10 35 0
-25 20 17 0
35 -5 -42 0
-50 24 -5 0
-21 -26 2 0
-8 45 -21 0
-16 33 49 0
-38 6 16 0
5 21 37 0
8 38 31 0
-21 33 14 0
20 40 -5 0
-29 -9 31 0
-7 42 -22 0
-48 8 26 0
48 -38 33 0
-34 49 46 0
-14 -46 25 0
-46 4 18 0
36 -12 -31 0
12 -18 14 0
-7 46 -16 0
9 -8 7 0
49 -42 -22 0
22 -15 38 0
34 -41 47 0
22 -26 32 0
-25 -45 -21 0
-26 32 -11 0
15 26 -25 0
-1 46 25 0
-14 -31 30 0
-9 -22 12 0
-18 26 -35 0
-16 -32 -21 0
31 -49 -21 0
11 9 41 0
-13 -30 19 0
-10 4 6 0
-4 3 -22 0
-25 -50 -18 0
-40 4 9 0
37 20 46 0
-27 22 -29 0
34 14 3 0
3 -31 20 0
-50 2 -26 0
17 -29 38 0
-49 12 -41 0
15 -35 -43 0
-22 -23 -49 0
-9 33 48 0
26 29 35 0
27 -50 37 0
-7 46 -43 0
-46 -37 -8 0
-40 36 -24 0
-44 46 15 0
-3 36 -16 0
-48 9 43 0
-25 -4 44 0
-22 37 -7 0
-31 -17 -22 0
-11 -48 17 0
23 34 -28 0
23 -48 -39 0
-37 -1 -23 0
-19 27 14 0
-22 33 -6 0
-6 -32 -26 0
18 -20 -46 0
43 22 27 0
-13 34 49 0
-35 -46 3 0
32 39 -43 0
6 -39 -9 0
27 39 -16 0
25 -17 -15 0
-43 27 34 0
-6 49 5 0
-38 11 14 0
40 -38 47 0
37 -14 17 0
39 29 36 0
-39 -28 1 0
-18 14 -16 0
-40 50 15 0
37 -42 18 0
-13 31 33 0
2 -42 33 0
8 -3 -22 0
1 23 -31 0
-20 -45 26 0
42 11 49 0
29 11 -43 0
-20 -21 30 0
23 45 -35 0
38 -30 -14 0
-9 48 -29 0
11 -18 -23 0
-41 -1 -29 0
5 41 26 0
44 -30 -7 0
38 -6 -41 0
46 48 -15 0
-18 -10 -47 0
38 46 -32 0
-32 46 12 0
31 40 14 0
-18 2 49 0
28 -38 27 0
-16 -21 14 0
-29 15 12 0
49 34 5 0
14 22 -12 0
30 33 20 0
-24 22 25 0
4 -48 -23 0
-30 -36 9 0
44 12 -35 0
38 3 -21 0
-11 33 49 0
%
0""" # noqa
